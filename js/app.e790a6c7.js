(function(e){function t(t){for(var r,o,i=t[0],c=t[1],u=t[2],f=0,m=[];f<i.length;f++)o=i[f],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&m.push(a[o][0]),a[o]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);l&&l(t);while(m.length)m.shift()();return s.push.apply(s,u||[]),n()}function n(){for(var e,t=0;t<s.length;t++){for(var n=s[t],r=!0,i=1;i<n.length;i++){var c=n[i];0!==a[c]&&(r=!1)}r&&(s.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},a={app:0},s=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/overlay-retro-chat/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=t,i=i.slice();for(var u=0;u<i.length;u++)t(i[u]);var l=c;s.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},1:function(e,t){},"173b":function(e,t,n){},2:function(e,t){},"5c0b":function(e,t,n){"use strict";n("9c0c")},"76ea":function(e,t,n){"use strict";n("173b")},"9c0c":function(e,t,n){},cd49:function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("2b0e"),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[e.messages.length?n("section",{staticClass:"message-list"},e._l(e.messages,(function(e,t){return n("ChatMessage",{key:t,attrs:{message:e.text,"user-state":e.userState,user:e.user,direction:t%2===0?"left":"right"}})})),1):e._e()])},s=[],o=(n("99af"),n("4de4"),n("4160"),n("fb6a"),n("b64b"),n("2ca0"),n("159b"),n("5530")),i=(n("96cf"),n("1da1")),c=n("3cba"),u=(n("d81d"),n("a9e3"),n("ac1f"),n("1276"),n("3835"));function l(e,t){var n=t.split("-").map(Number),r=Object(u["a"])(n,2),a=r[0],s=r[1];return{emoteId:e,emoteImageTag:"<img class='emote' src='https://static-cdn.jtvnw.net/emoticons/v1/".concat(e,"/1.0'/>"),emoteUrl:"https://static-cdn.jtvnw.net/emoticons/v1/".concat(e,"/1.0"),start:a,end:s}}var f=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("section",{staticClass:"message",class:{"-left":"left"===e.direction,"-right":"right"===e.direction}},[n("div",{staticClass:"nes-balloon",class:{"from-left":"left"===e.direction,"from-right":"right"===e.direction}},[n("p",{staticClass:"message-text",domProps:{innerHTML:e._s(e.message)}})]),n("div",{staticClass:"fr",class:{"fr-left":"left"===e.direction,"fr-right":"right"===e.direction}},[n("img",{staticClass:"nes-avatar is-rounded is-large",attrs:{src:e.user.profileImage}}),e._v(" "),n("p",{staticClass:"displayName"},[e._v(e._s(e.userState["display-name"]))])])])},m=[],p={props:["message","userState","direction","user"],name:"ChatMessage"},d=p,g=(n("76ea"),n("2877")),h=Object(g["a"])(d,f,m,!1,null,"7c917d1d",null),b=h.exports,v=n("bc3a"),_=n.n(v),w=n("2f62"),y=Object({NODE_ENV:"production",BASE_URL:"/overlay-retro-chat/"}).VUE_APP_CLIENT_SECRET,I=Object({NODE_ENV:"production",BASE_URL:"/overlay-retro-chat/"}).VUE_APP_CLIENT_ID,O=null;function k(){return _.a.post("https://id.twitch.tv/oauth2/token?scope=user:read:email&response_type=token&client_secret=".concat(y,"&grant_type=client_credentials&client_id=").concat(I),{headers:{Accept:"application/vnd.twitchtv.v5+json"}}).then((function(e){return O=e.data.access_token,O})).catch((function(e){return console.error("[ERROR] Failed twitch auth",e.response.data),""}))}var j=n("2b0e").default,E=j.extend({name:"App",components:{ChatMessage:b},mounted:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.getTokenData(),n=c["client"]({options:{debug:!0},connection:{reconnect:!0,secure:!0},channels:["gacbl"]}),n.connect().catch(console.error),n.on("message",function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(n,r,a,s){var o,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!s){t.next=2;break}return t.abrupt("return");case 2:if(!a.startsWith("!")){t.next=4;break}return t.abrupt("return");case 4:return o=a,r.emotes&&function(){for(var e=[],t=function(){var t=s[n],a=r.emotes[t];a.forEach((function(n){e.push(l(t,n))}))},n=0,s=Object.keys(r.emotes);n<s.length;n++)t();e.sort((function(e,t){return t.end-e.end})),e.forEach((function(e){var t=o.slice(0,e.start);t+=e.emoteImageTag,t+=o.slice(e.end+1,o.length),o=t})),a=o}(),i={id:"",username:r.username,displayName:r["display-name"]||""},t.next=9,e.getProfileImage(r);case 9:i.profileImage=t.sent,i.profileImageTimestamp=Date.now(),e.addUser(i),e.addMessage({text:a,userState:r,timestamp:Date.now(),user:i});case 13:case"end":return t.stop()}}),t)})));return function(e,n,r,a){return t.apply(this,arguments)}}());case 4:case"end":return t.stop()}}),t)})))()},data:function(){var e=[];return{messages:e,tkn:""}},computed:Object(o["a"])({},Object(w["b"])("UserStore",["getToken","getImageUrl"])),methods:Object(o["a"])(Object(o["a"])({},Object(w["c"])("UserStore",["setToken","setProfileImage","addUser"])),{},{addMessage:function(e){this.messages=this.messages.filter((function(e){return e.timestamp>Date.now()-3e4})),this.messages.length>0&&this.messages[this.messages.length-1].userState.username===e.userState.username?this.messages[this.messages.length-1].text+="<br/><br/><hr/><br/>"+e.text:this.messages.push(e),this.$nextTick((function(){window.scrollTo(0,document.body.scrollHeight)}))},removeOldMessages:function(){this.messages=this.messages.filter((function(e){return e.timestamp>Date.now()-3e4}))},getTokenData:function(){var e=this,t=this.getToken;if(null!==t)return this.tkn=t,t;k().then((function(t){e.tkn=t,e.setToken(t)}))},getProfileImage:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=t.getImageUrl(e),!(null!==r&&void 0!==r&&r.length>0)){n.next=3;break}return n.abrupt("return",r.profileImage);case 3:return n.next=5,_.a.get("https://api.twitch.tv/helix/users?login=".concat(e.username,"&client_id=").concat(Object({NODE_ENV:"production",BASE_URL:"/overlay-retro-chat/"}).VUE_APP_CLIENT_ID),{headers:{Authorization:"Bearer ".concat(t.tkn),"Client-Id":Object({NODE_ENV:"production",BASE_URL:"/overlay-retro-chat/"}).VUE_APP_CLIENT_ID}}).then((function(n){var r=n.data;return t.setProfileImage({username:e.username,profileImage:r.data[0]["profile_image_url"]}),r.data[0]["profile_image_url"]})).catch((function(e){return console.error(e.response),""}));case 5:return n.abrupt("return",n.sent);case 6:case"end":return n.stop()}}),n)})))()}})}),x=E,T=(n("5c0b"),Object(g["a"])(x,a,s,!1,null,null,null)),S=T.exports,P=n("bfa9"),U=(n("c740"),{namespaced:!0,state:{token:null,users:[]},getters:{users:function(e){return e.users},user:function(e,t){var n=e.users.filter((function(e){return e.username===t.username}));return n[0]||null},getToken:function(e){return e.token},getImageUrl:function(e){return function(t){var n=e.users.filter((function(e){return e.username===t.username}));return 0!==n.length&&n[0].profileImage?{profileImage:n[0].profileImage||null,profileImageTimestamp:n[0].profileImageTimestamp||null}:null}}},mutations:{addUser:function(e,t){-1===e.users.findIndex((function(e){return e.username===t.username}))&&e.users.push(t)},setToken:function(e,t){e.token=t},setProfileImage:function(e,t){var n=t.username,r=t.profileImage,a=e.users.findIndex((function(e){return e.username===n}));-1!==a&&(e.users[a].profileImage=r)}}}),C=U;r["default"].use(w["a"]);var N=new P["a"]({key:"gft",storage:window.localStorage,reducer:function(e){return{UserStore:e.UserStore}}}),R=new w["a"].Store({plugins:[N.plugin],state:{},mutations:{},actions:{},modules:{UserStore:C}});n("33e9");r["default"].config.productionTip=!1,new r["default"]({store:R,render:function(e){return e(S)}}).$mount("#app")}});
//# sourceMappingURL=app.e790a6c7.js.map